# 【MCPowerSEM: Structural Equation Modeling Power Analysis use Monte-Carlo Method】

基于Monte-Carlo法的SEM统计检验力分析

* 相关信息：

>Version: Alpha 0.0.1
>
>R Version: ≥ 3.4
>
>Depends: lavaan
>
>Author: Kazuha_Yae
>
>License: GPL ≥ 2

* 目的：基于R语言开发基于Monte-Carlo方法的SEM统计检验力分析

* 函数接口：

主函数：MCPowerSEM，该函数需要传入的参数包括genMod, genCov, anaMod, REP, N, std, seed，各参数含义如下

|传入参数| 说明                                     |
| :----: | :--------------------------------------: |
| genMod | 用以生成虚拟数据的理论模型               |
| genCov | 用以生成虚拟数据的协方差矩阵             |
| anaMod | 实际进行分析时所执行的模型               |
| REP    | 模拟的重复次数                           |
| N      | 模拟样本量                               |
| std    | 是否需要根据“智能”还原标准化的协方差矩阵 |
| seed   | 随机数种子                               |

该函数构建一个MCPowerSEM类的实例，该实例中的各个属性记录了模型设置与模拟抽样的分析结果，该类的属性包括

|         属性 |    说明                                            |
| :----------: | :------------------------------------------------: |
|generate.mod  | 用以生成模拟数据的模型（以lavaan模型指定）         |
|generate.cov  | 用以生成模拟数据的协方差矩阵（直接以矩阵形式指定） |
|std.reg       | 是否需要根据“智能”还原标准化的协方差矩阵           |
|analysis.mod  | 用以进行分析的模型                                 |
|simulate.n    | 样本容量                                           |
|repeated      | 重复次数                                           |
|seed          | 起始种子                                           |
|origin.mod    | 原始模型                                           |
|simulate.seed | 生成模拟数据用的种子                               |
|result.fitting| 模拟得到的模型拟合                                 |
|result.paraest| 模拟得到的参数估计值                               |
|result.simcov | 模拟数据的协方差矩阵                               |

该类存在下述方法

| 方法   |  说明                                                                                             |
| :----: | :------:                                                                                          |
|parCover| 考察实际生成样本的协方差矩阵与生成数据的协方差矩阵的参数覆盖情况                                  |
|estCover| 考察实际生成样本的估计值与生成数据的模型之间的参数覆盖情况，并给出α为0.05和0.01水平下的统计检验力 |
|fitCover| 考察实际生成样本的拟合情况与生成数据的模型之间的参数覆盖情况，尚未完成                            |
|summary | 同时给出前三者的结果，并给出分析过程中的参数，尚未完成                                            |

* 使用范例：

```
# 示例程序
# 模型来源于Sarah提出的问题
genMod = '
Y  ~ 0.1 * C + - 0.2 * X + 0.2 * M1 + 0.2 * M2
M1 ~ 0.1 * C + - 0.2 * X 
M2 ~ 0.1 * C + - 0.2 * X 
X  ~ 0.1 * C
'

anaMod = '
Y  ~ C + X + b1 * M1 + b2 * M2
M1 ~ C + a1 * X 
M2 ~ C + a2 * X 
X  ~ C
ab1 := a1 * b1
ab2 := a2 * b2
'

ana.test = MCPowerSEM(genMod = genMod, genCov = NULL, anaMod = anaMod, REP = 1000L, N = 401, std = TRUE, seed = 12345678)

summary(ana.test)
```

*

* 一些特别的备注：

   * 目前只支持单层单组模型相关的统计检验力分析，分层/分组结构方程模型相关的功能尚需进一步开发
   * 理论上支持涉及调节项的模型，但不支持潜调节结构方程模型（lavaan包原生不支持）
      * 特别说明：使用涉及调节项的模型时，请将乘积项视为与其他变量地位对等的变量，指定蕴含所有变量的协方差矩阵或生成模型
	  ```
	  # 举一个简单的栗子，对于模型 Y ~ X + W + XW 来说，应当传入的是X, W, XW三个变量的协方差矩阵，而不仅仅是是X与W的协方差矩阵
	  ```
   * 请**严格注意**生成模型中的参数指定！该程序没有内置生成模型的检查功能，错误地指定生成模型（通常是遗漏关键参数或指定了冲突的参数）可能导致模型自动生成的理论协方差矩阵与您希望得到的协方差矩阵并不相同
   * 若使用该方法分析模型拟合指数（如RMSEA、CFI等）时，由于抽样误差的缘故，在使用根据前人研究或Meta分析生成的协方差矩阵或根据数据进行事后敏感性分析时，该方法会***严重***错估统计检验力，解决该问题的方法正在集成中，如果研究者希望*马上*使用该功能，可以参考Cheng和Wu（2017）的研究
   * 目前尚不支持指定生成模型的情况下对具有**任意**RMSEA特征的总体协方差矩阵进行模拟的功能，但相关功能已在开发中，如果研究者希望*马上*使用该功能，可以参考Cudeck与Browne（1992）的研究
   * 目前在对结构方程模型参数或参数函数的检验中仅支持Wald检验（Delta法），将来可能支持Lagrange乘子检验和似然比检验【但二者的主执行程序不同，可能需要重构类，但作者过懒\_(:3」∠)_】，并且应该不会支持自举法【耗时过长，怎么想都不是一个划算的结果，并且作者不会写多线程（后者是重点）】；但一个好消息是，通常情况下Wald检验具有所有该类检验中最低的检验力，所以更换方法只会提升检验的有效性
   * 暂时不支持对主程序估计时所选参数的更改（如拟合方法、似然函数类型等），原因与为何不支持Lagrange乘子检验和似然比检验一样
   * 结果整理时默认使用了对称区间，没使用最高密度区间，该功能待完善
   * 只完成了简单的关于模型参数检验的部分，并且暂时只支持α = 0.05和0.01的双侧检验（power95和power99），但结果都在Slot里了，研究者有需要可以自己定制功能
   * **进一步修改方向：添加对更多模型/方法的支持，重新整理类关系，构建MCPower类作为若干具体方法的父类，将MCPowerSEM重构为MCPower的一个子类（但实在懒得改了）**
   * 标准化输出太丑了，急需美化！！！
   * 想起来再补\_(:3」∠)_   